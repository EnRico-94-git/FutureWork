<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${colaborador.id} != null ? 'Editar Colaborador' : 'Novo Colaborador'">
        Future Work
    </title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<main class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">

            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0"
                        th:text="${colaborador.id} != null ? 'Editar Colaborador' : 'Novo Colaborador'">
                        Novo Colaborador
                    </h4>
                </div>

                <div class="card-body">
                    <!-- MENSAGEM DE ERRO GERAL -->
                    <div th:if="${erro}" class="alert alert-danger alert-dismissible fade show" role="alert">
                        <span th:text="${erro}">Ocorreu um erro.</span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>

                    <!-- FORMULÁRIO -->
                    <form th:action="@{/colaboradores/salvar}"
                          th:object="${colaborador}"
                          method="post"
                          id="formColaborador"
                          novalidate>

                        <!-- ID (hidden) -->
                        <input type="hidden" th:field="*{id}" />

                        <!-- Nome -->
                        <div class="mb-3">
                            <label for="nome" class="form-label">Nome *</label>
                            <input type="text"
                                   id="nome"
                                   class="form-control"
                                   th:field="*{nome}"
                                   th:classappend="${#fields.hasErrors('nome')} ? ' is-invalid' : ''"
                                   minlength="2"
                                   maxlength="100"
                                   required
                                   placeholder="Digite o nome completo" />
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('nome')}">
                                <span th:errors="*{nome}">Erro no nome</span>
                            </div>
                        </div>

                        <!-- Email -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Email *</label>
                            <input type="email"
                                   id="email"
                                   class="form-control"
                                   th:field="*{email}"
                                   th:classappend="${#fields.hasErrors('email')} ? ' is-invalid' : ''"
                                   required
                                   placeholder="exemplo@email.com" />
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}">
                                <span th:errors="*{email}">Erro no email</span>
                            </div>
                        </div>

                        <!-- Habilidades -->
                        <div class="mb-3">
                            <label for="habilidades" class="form-label">Habilidades *</label>
                            <textarea id="habilidades"
                                      class="form-control"
                                      rows="3"
                                      th:field="*{habilidades}"
                                      th:classappend="${#fields.hasErrors('habilidades')} ? ' is-invalid' : ''"
                                      maxlength="500"
                                      required
                                      placeholder="Ex: Java, Spring Boot, Oracle, Docker"></textarea>
                            <div class="form-text">
                                Liste as principais habilidades separadas por vírgula (máx. 500 caracteres).
                            </div>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('habilidades')}">
                                <span th:errors="*{habilidades}">Erro nas habilidades</span>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Modelo de Trabalho -->
                            <div class="col-md-6 mb-3">
                                <label for="modeloTrabalho" class="form-label">Modelo de Trabalho *</label>
                                <select id="modeloTrabalho"
                                        class="form-select"
                                        th:field="*{modeloTrabalho}"
                                        th:classappend="${#fields.hasErrors('modeloTrabalho')} ? ' is-invalid' : ''"
                                        required>
                                    <option value="">Selecione...</option>
                                    <option th:each="m : ${modelosTrabalho}"
                                            th:value="${m}"
                                            th:text="${m}">
                                    </option>
                                </select>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('modeloTrabalho')}">
                                    <span th:errors="*{modeloTrabalho}">Erro no modelo de trabalho</span>
                                </div>
                            </div>

                            <!-- Nível de IA -->
                            <div class="col-md-6 mb-3">
                                <label for="nivelIA" class="form-label">Nível de IA *</label>
                                <select id="nivelIA"
                                        class="form-select"
                                        th:field="*{nivelIA}"
                                        th:classappend="${#fields.hasErrors('nivelIA')} ? ' is-invalid' : ''"
                                        required>
                                    <option value="">Selecione...</option>
                                    <option th:each="n : ${niveisIA}"
                                            th:value="${n}"
                                            th:text="${n}">
                                    </option>
                                </select>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('nivelIA')}">
                                    <span th:errors="*{nivelIA}">Erro no nível de IA</span>
                                </div>
                            </div>
                        </div>

                        <!-- BOTÕES -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <a th:href="@{/colaboradores}" class="btn btn-secondary me-md-2">
                                Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary" id="btnSubmit">
                                <span th:text="${colaborador.id} != null ? 'Atualizar' : 'Criar'">
                                    Criar
                                </span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</main>

<div th:replace="fragments/footer :: footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // evitar clique duplo
    const form = document.getElementById('formColaborador');
    if (form) {
        form.addEventListener('submit', function (e) {
            const btn = document.getElementById('btnSubmit');
            if (btn) {
                btn.disabled = true;
                btn.innerText = 'Salvando...';
            }
        });
    }
</script>
</body>
</html>
